name: Authenticate with GCP
description: |
  Authenticates with GCP and configures both Docker and Kubernetes to work with GCP.
  Requires the GCP_SA_KEY secret to be set.
inputs:
  key:
    description: GCP_SA_KEY secret, generated by creating a new JSON key and base64-encoding it.
    required: true
runs:
  using: composite
  steps:
    - uses: google-github-actions/auth@v0.8.2 # https://github.com/google-github-actions/auth/releases.
      with:
        credentials_json: ${{ inputs.key }}
    - shell: bash
      run: gcloud --quiet auth configure-docker us-docker.pkg.dev
    - uses: google-github-actions/get-gke-credentials@v0.7.0
      with:
        project_id: circular-genius
        cluster_name: limber
        location: us-central1
